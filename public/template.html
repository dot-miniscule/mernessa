<html>
  <head>
    <title>Stack Tracker</title>
    <!--<link rel="icon" type"image/x-icon" href="favicon.ico">-->
    <link rel="stylesheet" type="text/css" href="stylesheets/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  </head>
  {{$reply := .}}
  <body>
    <div class="wrap">
      <div class="innerWrap">
        <div id="userDiv">
          <p id="welcomeSentence"> Welcome,
            {{if eq $reply.User.Display_name "Guest"}}
              {{$reply.User.Display_name}} <a href="/login">Login</a>
            {{else}}
              <a href="/user?id={{$reply.User.User_id}}">{{$reply.User.Display_name}} <img src="{{$reply.User.Profile_image}}" style="height:20px; width:20px"></a>
            {{end}}
          </p>
        </div><!-- END USER DIV -->
        <div class="titleBar">
          <a href="/"><img src="images/stacktracker-banner.jpg"></a>
          {{if ne $reply.Query ""}}
            <h6>Querying: {{$reply.Query}}</h6>
          {{end}}
        </div><!-- END TITLE BAR -->
        <div class="content">
          <div class="sitenav">
              <ul>
                <li><a href='/'>Home</a></li>
                <li><a href='/viewTags'>Tags</a></li>
                <li><a href='/viewUsers'>Users</a></li>
              </ul>
          </div>
          <!--<div class="sidebar">
          </div>--> 
          <div class="tab-panels">
            <ul class="tabs">
              <li rel="unanswered" class="navigation">Unanswered ({{len ((index $reply.Caches 0).Questions)}})</li>
              <li rel="answered" class="navigation">Answered ({{len ((index $reply.Caches 1).Questions)}})</li>
              <li rel="pending" class="navigation">Pending ({{len ((index $reply.Caches 2).Questions)}})</li>
              <li rel="updating" class="navigation">Update ({{len ((index $reply.Caches 3).Questions)}})</li>
            </ul>
            <div class="whitespace"></div>
            <form name="change_state" id="stateForm" method="POST">
              {{range $cache := $reply.Caches}}
              <div id="{{$cache.CacheType}}" class="panel">
                <div class="info">
                  <p>{{$cache.Info}}</p>
                </div>
                <div class="tableContainer">
                  <table>
                    <thead>
                      <tr>
                        <th class="qHead">Question</th>
                        <th></th>
                        {{if ne $cache.CacheType "answered"}}
                          <th>Other states:</th>
                        {{end}}
                      </tr>
                    </thead>
                    <tbody>
                      {{range $question := $cache.Questions}}
                        <tr>
                          <td class="question">
                            <a href={{$question.Link}} target="_blank" class="question_title">{{$question.Title}}</a>
                            <br>
                            <div class="bodySnippet" id="{{$question.Question_id}}_body">{{$question.Body}}...<br></div><!--END OF BODY SNIPPET-->
                            <div class="tagContainer">
                              <ul>
                              {{range $tag := $question.Tags}}  
                                <li class="tag" a href="#" data-tooltip="tooltip" title="Display questions containing the tag &quot;{{$tag}}&quot;"><a href="/tag?tagSearch={{$tag}}">{{$tag}}</a></li>
                              {{end}}
                              </ul>
                            </div>
                            {{if ne $cache.CacheType "unanswered"}}
                              {{$owner := index $reply.Qns $question.Question_id}}
                              <p class="questionOwner">Question marked as {{$cache.CacheType}} by <a href="/user?id={{$owner.User_id}}">{{$owner.Display_name}}</a>
                                {{if ne $question.Last_edit_date 0}}
                                  on {{$reply.Timestamp $question.Last_edit_date}}
                                {{end}}
                              </p>
                            {{end}}
                          </td>
                          {{if eq $cache.CacheType "unanswered"}}
                            <td><input type="button" name="{{$cache.CacheType}}_{{$question.Question_id}}" class="one-click" value="Pending" onclick="$(this).addClass('clicked'); return submitForm({{$reply.User.Display_name}}, 'pending', {{$reply.UpdateTime}});"></td>
                            <td>
                              <select name="{{$cache.CacheType}}_{{$question.Question_id}}" class="new_state_menu">
                                <option value="no_change"></option>
                                <option value="answered">Answered</option>
                                <option value="updating">Updating</option>
                                <option value="pending" style="display:none"></option>
                              </select>
                            </td>
                          {{else if eq $cache.CacheType "answered"}}
                            <td><input type="button" name="{{$cache.CacheType}}_{{$question.Question_id}}" class="one-click" value="Reopen" onclick="$(this).addClass('clicked'); return submitForm({{$reply.User.Display_name}}, 'pending', {{$reply.UpdateTime}});"></td>
                            <td style="display:none">
                              <select name="{{$cache.CacheType}}_{{$question.Question_id}}" class="new_state_menu">
                                <option value="no_change"></option>
                                <option value="pending"></option>
                              </select>
                            </td>
                          {{else}}
                            <td><input type="button" name="{{$cache.CacheType}}_{{$question.Question_id}}" class="one-click" value="Answered" onclick="$(this).addClass('clicked'); return submitForm({{$reply.User.Display_name}}, 'answered', {{$reply.UpdateTime}});"></td>
                            <td>
                              <select name="{{$cache.CacheType}}_{{$question.Question_id}}" class="new_state_menu">
                                <option value="no_change"></option>
                                {{if eq $cache.CacheType "updating"}}
                                  <option value="pending">Pending</option>
                                {{else if eq $cache.CacheType "pending"}}
                                  <option value="updating">Updating</option>
                                {{end}}
                                <option value="answered" style="display:none"></option>
                              </select>
                            </td>
                          {{end}}
                        </tr>
                      {{end}}
                    </tbody>
                  </table>
                </div> <!-- END TABLE CONTAINER -->
              </div> <!-- END PANEL -->
              {{end}}
            </form>
          </div><!--END TAB-PANELS-->
        </div> <!--END CONTENT-->
        <div class="stickyFooter">
          <div class="footerContents">
            <div id="submitContainer">
              <input type="button" name="clear" id="clearButton" value="Clear">
              <input type="button" name="btnSubmit" id="submitButton" value="Submit" onclick="return submitForm({{$reply.User.Display_name}}, 'submit', {{$reply.UpdateTime}});">
            </div> <!-- END SUBMIT CONTAINER -->
          </div><!--END FOOTER CONTENTS-->
        </div><!-- END FOOTER -->
      </div> <!-- END INNER WRAPPER -->
    </div> <!-- END WRAPPER -->
  </body>
  <script type="text/javascript" src="/javascripts/tabs.js"></script>
  <script>
    function checkUser(username) {
    console.log('checking');
      return username === "Guest";
    }

    function submitForm(username, type, updateTime) {
      if (checkUser(username)) {
        alert('Must be logged in to submit');
        return false;
      }
      return checkDB(type, updateTime);
    }
  </script>
</html>
